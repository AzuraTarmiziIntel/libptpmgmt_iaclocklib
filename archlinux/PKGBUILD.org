# SPDX-License-Identifier: GPL-3.0-or-later
# SPDX-FileCopyrightText: Copyright 2021 Erez Geva
#
# Maintainer: Erez Geva <ErezGeva2@gmail.com>
#
# @author Erez Geva <ErezGeva2@@gmail.com>
# @copyright 2021 Erez Geva
#
###############################################################################
pkgver=0.9
pkgrel=1
pkgname=(libptpmgmt libptpmgmt-jsonc libptpmgmt-dev libptpmgmt-doc
  libptpmgmt-perl lua-ptpmgmt ruby-ptpmgmt tcl-ptpmgmt
  python3-ptpmgmt pmc-ptpmgmt phc-ctl-ptpmgmt)
# Source code can be build on any architecture
# But as Arch Linux does not support the 'all' keyword
arch=(x86_64)
url=https://github.com/erezgeva/libptpmgmt
license=(LGPL3)
source=("$pkgname-$pkgver.txz")
# Target library directory
libdir='usr/lib'
# version for depends
verdep="$pkgver-$pkgrel"
build() {
  # Exclude PHP as it does not have a system include path
  make -j LD_SONAME=1 CPPFLAGS_OPT=-Ofast PMC_USE_LIB=so SONAME_USE_MAJ=1\
    NO_PHP=1 --no-print-directory all doxygen
  # Place here as make do not use packages!
  make -j DESTDIR=install install SBINDIR=/usr/bin\
    NO_PHP=1 SONAME_USE_MAJ=1 LIBDIR=/usr/lib --no-print-directory
}
makedepends=(doxygen graphviz perl ruby tcl swig lua lua51 lua52 lua53\
  python3 json-c)
package_libptpmgmt() {
  pkgdesc='PTP management library, to communicate with ptp4l'
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/libptpmgmt.so.* $pkgdir/$libdir
}
package_libptpmgmt-jsonc() {
  pkgdesc='PTP management library JSON plugin using the json-c library'
  depends=("libptpmgmt=$verdep" json-c)
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/libptpmgmt_jsonc.so.* $pkgdir/$libdir
}
package_libptpmgmt-dev() {
  # development package can use static library
  # But as Arch linux does not use development packages, we add it here
  options=(staticlibs)
  pkgdesc='PTP management library development, provides header files and static library.'
  depends=("libptpmgmt=$verdep")
  mkdir -p $pkgdir/$libdir $pkgdir/usr/share
  mv $srcdir/install/usr/share/libptpmgmt-dev $pkgdir/usr/share
  mv $srcdir/install/usr/include $pkgdir/usr
  mv $srcdir/install/usr/lib/libptpmgmt*.a $pkgdir/$libdir
  mv $srcdir/install/usr/lib/libptpmgmt.so $pkgdir/$libdir
}
package_libptpmgmt-doc() {
  arch=(any)
  pkgdesc='PTP management library documentation, to communicate with ptp4l'
  license=(FDL1.3)
  mkdir -p $pkgdir/usr/share
  mv $srcdir/install/usr/share/doc/* $pkgdir/usr/share
}
package_libptpmgmt-perl() {
  pkgdesc='PTP management library Perl wrapper'
  depends=("libptpmgmt=$verdep" perl)
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/perl* $pkgdir/$libdir
}
package_python3-ptpmgmt() {
  pkgdesc='PTP management library python version 3 wrapper'
  depends=("libptpmgmt=$verdep" python3)
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/python3* $pkgdir/$libdir
}
package_lua-ptpmgmt() {
  pkgdesc='PTP management library Lua wrapper'
  depends=("libptpmgmt=$verdep" lua lua51 lua52 lua53)
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/lua* $pkgdir/$libdir
  mv $srcdir/install/usr/lib/liblua* $pkgdir/$libdir
}
package_ruby-ptpmgmt() {
  pkgdesc='PTP management library ruby wrapper'
  depends=("libptpmgmt=$verdep" ruby)
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/ruby $pkgdir/$libdir
}

package_tcl-ptpmgmt() {
  pkgdesc='PTP management library tcl wrapper'
  depends=("libptpmgmt=$verdep" tcl)
  mkdir -p $pkgdir/$libdir
  mv $srcdir/install/usr/lib/tcl* $pkgdir/$libdir
}

#package_php-ptpmgmt() {
# Arch linux php7 do not have system include_path!
# pkgdesc='PTP management library php wrapper'
# depends=("libptpmgmt=$verdep" php7)
# mkdir -p $pkgdir/$libdir
# mv $srcdir/install/usr/lib/php* $pkgdir/$libdir
#}
package_pmc-ptpmgmt() {
  license=(GPL3)
  depends=("libptpmgmt=$verdep")
  pkgdesc='pmc tool. new rewrite of linuxptp pmc tool using the libptpmgmt library.'
  mkdir -p $pkgdir/usr/local/man/man8 $pkgdir/usr/bin
  mv $srcdir/install/usr/bin/pmc* $pkgdir/usr/bin
  mv $srcdir/install/usr/share/man/man8/pmc* $pkgdir/usr/local/man/man8
}
package_phc-ctl-ptpmgmt() {
  license=(GPL3)
  depends=("python3-ptpmgmt=$verdep")
  pkgdesc='phc_ctl tool. new rewrite of linuxptp phc_ctl tool using the libptpmgmt library.'
  mkdir -p $pkgdir/usr/local/man/man8 $pkgdir/usr/bin
  mv $srcdir/install/usr/bin/phc_ctl* $pkgdir/usr/bin
  mv $srcdir/install/usr/share/man/man8/phc_ctl* $pkgdir/usr/local/man/man8
}
changelog=changelog
